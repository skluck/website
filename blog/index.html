<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Yet Another Programming Blog</title>

    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/simple-sidebar.css" rel="stylesheet">
    <link href="/blog/css/hr-style.css" rel="stylesheet">
    <script src="/blog/js/jquery-1.11.0.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
    <div id="page-content-wrapper">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <h1>Yet Another Programming Blog</h1>
                    <h2>A work in progress. Go away.</h2>
                    <hr>
                </div>
            </div>
            <div class="row">
            	<div class="col-lg-8" id="latest">
            		<h2>Windows 7 and Samba: Playing Nicely</h2>
            		<p>
            			I recently tried to set up some network shares between my servers and my desktop, hoping to alleviate 
            			the syncing and latency issues that I often experienced with large projects under Dropbox.
            		</p>
            		<p>
            			I had no idea what I was stepping into.
            		</p>
            		<p>
            			I started with NFS, assuming that it was the most common and would be easy to install across all of my systems.
            			Installation on Arch was relatively simple, only requiring the <code>nfs-utils</code> package and a small amount of configuration.
            			Everything was looking good, until I tried to mount the share on Windows. Because I bought the "Home Edition" of Windows 
            			Microsoft, in its infinite wisdom, decided that I would never need their NFS implementation, or anything else from the "Services for UNIX"
            			package commonly available on "Enterprise" versions of Windows.
            		</p>
            		<p>
            			No problem, I thought. I would install an implementation on my own. I quickly discovered that Microsoft had, in fact, sponsored the development
            			of a native NFSv4.1 implementation for Windows by the <a href="http://www.citi.umich.edu/projects/nfsv4/windows/">CITI group</a> at the University of Michigan.
            			To my surprise and joy, CITI had the presence of mind to release their work both in source and binary form, along with detailed instructions for installation.
            			I blazed through their instructions, anticipating success, and promptly botched the entire job. In the subsequent fit of frustration, I uninstalled NFS from my server,
            			and forgot about all of the little configuration changes I had made to my desktop.
            		</p>
            		<p>
            			Fast forward about a month, and I was ready to try again. I went on the Samba route, expecting the native (and commonly used) SMB/CIFS implementation on Windows
            			to play nicely with Samba's (well tested) open source implementation. Just like with NFS, Samba's installation process on Linux was trivial: I installed the <code>samba</code>
            			package from my package manager, updated the configuration file, ran <code>testparm</code>, and started the <code>smbd</code> and <code>nmbd</code> services.
            			Initially, everything seemed fine. <code>smbclient</code> was able to connect to my shares, and other Unix and Linux clients could control them as permitted.
            		</p>
            		<p>
            			Then I tried to mount the share on Windows. Boom, cryptic error message. "0x80070002: The system cannot find the file specified."
            		</p>
            		<p>
            			As it turned out, after a little bit of searching, lots of other people had run into the error while trying to mount their SMB shares,
            			both from Windows and Linux clients. Unfortunately, as I soon discovered, this was because "0x80070002" is Windows-ese for "I don't know why this didn't work, so I'm going
            			blame the user and call it a day. Don't bug me."
            		</p>
            		<p>
            			After several hours of fruitless searching and asking on <a href="http://serverfault.com/questions/620558/cant-access-smb-shares-on-windows-but-can-on-linux/620620#620620">serverfault (Spoiler Alert!)</a>,
            			I finally came across <a href="http://panerarichang.blogspot.com/2011/07/win2k8error-code-0x80070002-system.html">a blog post by a guy named Chang</a>. In it, Chang discovers that a registry key,
            			<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\NetworkProvider\Order\ProviderOrder</code> was inadvertently overwritten. Because various Windows networking services check the <code>ProviderOrder</code>
            			for the correct implementation to use, a missing or malformed CSV string can completely bork or confuse many network processes. I opened up Regedit, navigated to the key, and guess what I find?
            		</p>
            		<p>
            			"NFSv4." The first entry in the <code>ProviderOrder</code> key was "NFSv4," causing any SMB service that queried the key looking for a SMB/CIFS implementation to immediately fail.
            			I deleted the offending entry, and appended Chang's suggested string, which included <code>mhgfs</code>, <code>hgfs</code>, <code>LanmanWorkstation</code>, and <code>RDPNP</code> as valid implementations.
            		</p>
                    <hr>
                    <h3><a href="/blog/archive/archive.html">Older posts</a></h3>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
